# Sourccey Robot Guide

This guide walks you through setting up and using the Sourccey robot, from initial calibration to teleoperation and data collection.

## Table of Contents

1. [Calibration](#calibration)
2. [Hosting the Robot](#hosting-the-robot)
3. [Teleoperation](#teleoperation)
4. [Recording Data](#recording-data)
5. [Training Models](#training-models)
6. [Evaluation](#evaluation)
7. [Utilities](#utilities)

---

## Calibration

Before using the robot, you need to calibrate both the robot and the teleoperator.

### Robot Calibration

Calibrate the robot arms on the Raspberry Pi:

```
uv run src/lerobot/scripts/sourccey/auto_calibrate.py \
 --robot.type=sourccey \
 --robot.id=sourccey
```

For a hard reset (re-detects mechanical limits):

```
uv run src/lerobot/scripts/sourccey/auto_calibrate.py \
 --robot.type=sourccey \
 --robot.id=sourccey \
 --full_reset=True
```

### Teleoperator Calibration

Find the ports for your robot

```
uv run src/lerobot/scripts/lerobot_find_port.py
```

Then Calibrate the bi-manual teleoperator (leader arms):

```
uv run src/lerobot/scripts/sourccey/auto_calibrate.py \
 --teleop.type=bi_sourccey_leader \
 --teleop.id=bi_sourccey_leader \
 --teleop.left_arm_port="COM11" \
 --teleop.right_arm_port="COM10"
```

For single-arm teleoperator:

```
python -m lerobot.calibrate \
 --teleop.type=sourccey_leader \
 --teleop.port=COM28 \
 --teleop.id=sourccey_leader
```

### Viewing/Editing Calibration Files

View calibration files:

```
cat ~/.cache/huggingface/lerobot/calibration/robots/sourccey_follower/sourccey_left.json
cat ~/.cache/huggingface/lerobot/calibration/robots/sourccey_follower/sourccey_right.json
```

Edit calibration files:

```
nano ~/.cache/huggingface/lerobot/calibration/robots/sourccey_follower/sourccey_left.json
nano ~/.cache/huggingface/lerobot/calibration/robots/sourccey_follower/sourccey_right.json
```

## Hosting the Robot

On the Raspberry Pi, start the robot host to enable remote control

```
uv run -m lerobot.robots.sourccey.sourccey.sourccey.sourccey_host
```

## Teleoperation

On your computer, activate the virtual environment and start teleoperation:

```

# On Linux/Mac
.venv/bin/activate


# On Windows
source .venv/Scripts/activate
```

# On Windows Then run:

```
python src/lerobot/control/sourccey/sourccey/teleoperate.py \
 --id="sourccey" \
 --remote_ip="192.168.1.230" \
 --left_arm_port="COM11" \
 --right_arm_port="COM10" \
 --keyboard_port="keyboard" \
 --fps=30
```

**Parameters:**

-   `--remote_ip`: IP address of the Raspberry Pi running the host
-   `--left_arm_port`: Serial port for left teleoperator arm (Windows: `COM3`, Linux: `/dev/ttyUSB0`)
-   `--right_arm_port`: Serial port for right teleoperator arm
-   `--fps`: Control loop frequency (default: 30)

## Recording Data

Record demonstration data for training:

```
python src/lerobot/control/sourccey/sourccey/record.py \
 --id="sourccey" \
 --remote_ip="192.168.1.225" \
 --left_arm_port="COM4" \
 --right_arm_port="COM3" \
 --dataset.repo_id="local/my_dataset" \
 --dataset.num_episodes=10 \
 --dataset.episode_time_s=60 \
 --dataset.reset_time_s=5 \
 --dataset.task="Fold the towel" \
 --dataset.fps=30 \
 --dataset.push_to_hub=false
```

**Key Parameters:**

-   `--dataset.repo_id`: Dataset identifier (use `local/` prefix for local storage)
-   `--dataset.num_episodes`: Number of episodes to record
-   `--dataset.episode_time_s`: Duration of each episode in seconds
-   `--dataset.reset_time_s`: Time between episodes for reset
-   `--dataset.task`: Task description for the dataset

---

## Training Models

Train an ACT policy on your recorded dataset:

### Single GPU Training

```
python src/lerobot/scripts/lerobot_train.py \
 --dataset.repo_id=sourccey-004/sourccey-004__coffee__001-005 \
 --policy.type=act \
 --output_dir=outputs/train/act__sourccey-004__coffee__001-005 \
 --job_name=act__sourccey-004__coffee__001-005 \
 --policy.device=cuda \
 --wandb.enable=false \
 --steps=100000 \
 --save_freq=20000 \
 --policy.push_to_hub=false
```

### Multi-GPU Training

```
accelerate launch \
  --multi_gpu \
  --num_processes=2 \
  $(which lerobot-train) \
  --dataset.repo_id=sourccey-004/sourccey-004__coffee__001-005 \
  --policy.type=act \
  --output_dir=outputs/train/act__sourccey-004__coffee__001-005 \
  --job_name=act_multi_gpu \
  --steps=100000 \
  --save_freq=20000 \
  --batch_size=128 \
  --wandb.enable=false \
  --policy.push_to_hub=false
```

# torchrun method deprecated as of 11/15/2025

#```
#torchrun --nproc_per_node=2 src/lerobot/scripts/train.py \

# --dataset.repo_id=local/my_dataset \

# --policy.type=act \

# --output_dir=outputs/train/act\*\*my_dataset \

# --job_name=act\*\*my_dataset \

# --policy.device=cuda \

# --wandb.enable=false \

# --policy.push_to_hub=false \

# --steps=300000 \

# --save_freq=20000 \

# --batch_size=64 \

# --distributed_training=true \

# --num_gpus=2

```

### Training on Pretrained Models

## Evaluation

Evaluate a trained model on the robot:

```

python src/lerobot/control/sourccey/sourccey/evaluate.py \
 --id="sourccey" \
 --remote_ip="192.168.1.243" \
 --model_path="outputs/train/act\_\_my_dataset/checkpoints/100000/pretrained_model" \
 --dataset.repo_id="local/eval_dataset" \
 --dataset.num_episodes=5 \
 --dataset.episode_time_s=30 \
 --dataset.reset_time_s=5 \
 --dataset.task="Fold the towel" \
 --dataset.fps=30

```

## Utilities

### Replay Recorded Data

Replay previously recorded episodes:

```

python src/lerobot/control/sourccey/sourccey/replay.py \
 --robot.type=sourccey \
 --robot.port=COM4 \
 --robot.id=sourccey \
 --dataset.repo_id=local/my_dataset \
 --dataset.episode=0

```

### Regenerating Protobuf Files

If you modify the protobuf definitions, regenerate the Python files:

```

rm -rf src/lerobot/robots/sourccey/sourccey/protobuf/generated
uv run python src/lerobot/robots/sourccey/sourccey/protobuf/compile.py

```

### Combining Datasets

Combine multiple datasets into one:

```

python src/lerobot/scripts/sourccey/combine_datasets.py \
 --dataset_paths='[
"sourccey-003/dataset-1",
"sourccey-003/dataset-2",
"sourccey-003/dataset-3"
]' \
 --output_path="sourccey-003/combined_dataset"

```

## **⚠️ Important:** Do not include trailing commas in the `--dataset_paths` array, as this will cause errors.

## Workflow Summary

1. **Calibrate** robot and teleoperator arms
2. **Host** the robot on Raspberry Pi (`sourccey_host`)
3. **Teleoperate** from your computer to control the robot
4. **Record** demonstration data for your task
5. **Train** a policy on the recorded data
6. **Evaluate** the trained model on the robot

---

## Troubleshooting

### Port Issues

-   Use `python -m lerobot.find_port` to find available serial ports
-   Ensure udev rules are set up correctly on Linux
-   Check port permissions: `ls -l /dev/ttyUSB*` or `ls -l /dev/ttyACM*`

### Connection Issues

-   Verify the Raspberry Pi IP address with `ip addr` or `ifconfig`
-   Ensure both devices are on the same network
-   Check firewall settings if connection fails

### Calibration Issues

-   If calibration fails, try a hard reset with `--full_reset=True`
-   Manually edit calibration files if needed (see [Viewing/Editing Calibration Files](#viewingediting-calibration-files))
```
